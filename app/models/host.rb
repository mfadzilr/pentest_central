class Host < ApplicationRecord
  belongs_to  :data_source
  has_many    :findings, dependent: :destroy

  validates :ip, presence: true
  validates_uniqueness_of :ip, scope: [:data_source_id]

  before_create :check_host_exist

  private

  def check_host_exist
    @project = Project.find(DataSource.find(self.data_source_id).project_id)
    if Host.where(data_source_id: @project.data_source_ids).find_by_ip(self.ip).nil?
      return true
    else
      throw(:abort)
    end
  end
end
