xml.instruct!
xml.Solaris_v1 do
  xml.Report(name: @data_source.name, 'xmlns:cm': 'http://www.nessus.org/cm') do
    Host.where(data_source_id: @data_source.id, enable: true).each do |host|
      xml.ReportHost(name: host.ip) do
        xml.HostProperties do
          xml.tag(host.platform, name: 'os')
          xml.tag(host.mac_address, name: 'mac-address')
          xml.tag(host.operating_system, name: 'operating-system')
          xml.tag(host.fqdn, name: 'host-fqdn')
          xml.tag(host.netbios_name, name: 'netbios-name')
          xml.tag(host.ip, name: "host-ip")
        end
        host.findings.where.not(severity: 0).where(enable: true).each do |v|
          xml.ReportItem(port: v.port, svc_name: v.service_name, protocol: v.protocol, severity: v.severity,
            pluginID: v.plugin_id, pluginName: v.name, pluginFamily: v.family, vulnID: v.id) do
              if !v.cve.nil?
                v.cve.split(',').each do |cve|
                  xml.cve cve
                end
              end
              if !v.cwe.nil?
                v.cwe.split(',').each do |cwe|
                  xml.cwe cwe
                end
              end
              xml.plugin_name v.name
              xml.plugin_type v.plugin_type
              xml.cvss_base_score v.cvss_base_score
              xml.synopsis v.synopsis
              xml.description v.description
              xml.solution v.solution
              if !v.category.nil?
                xml.category v.category
              end
              if !v.affected_url.nil?
                xml.affected_url v.affected_url
              end
              xml.request v.request
              xml.response v.response
              if !v.parameter.nil?
                xml.parameter v.parameter
              end
              if !v.xref.nil?
                v.xref.split(',').each do |xref|
                  xml.xref xref
                end
              end
          end
        end
      end
    end
  end
end
